"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4307],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var i=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=i.createContext({}),c=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return i.createElement(s.Provider,{value:t},e.children)},g="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),g=c(n),d=o,m=g["".concat(s,".").concat(d)]||g[d]||u[d]||a;return n?i.createElement(m,r(r({ref:t},p),{},{components:n})):i.createElement(m,r({ref:t},p))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,r=new Array(a);r[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[g]="string"==typeof e?e:o,r[1]=l;for(var c=2;c<a;c++)r[c]=n[c];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},13642:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>g,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var i=n(87462),o=(n(67294),n(3905));const a={},r="Hardware Debugging In Eclipse",l={unversionedId:"development/development/Hardware Debugging in Eclipse",id:"development/development/Hardware Debugging in Eclipse",title:"Hardware Debugging In Eclipse",description:"Build a binary with debugging information using command line or via Eclipse make target.",source:"@site/docs/development/development/Hardware Debugging in Eclipse.md",sourceDirName:"development/development",slug:"/development/development/Hardware Debugging in Eclipse",permalink:"/betaflight.com/docs/development/development/Hardware Debugging in Eclipse",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"development",previous:{title:"Flight-Controller-Design",permalink:"/betaflight.com/docs/development/development/Flight-Controller-Design"},next:{title:"Hardware debugging",permalink:"/betaflight.com/docs/development/development/Hardware Debugging"}},s={},c=[],p={toc:c};function g(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,i.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"hardware-debugging-in-eclipse"},"Hardware Debugging In Eclipse"),(0,o.kt)("p",null,"Build a binary with debugging information using command line or via Eclipse make target."),(0,o.kt)("p",null,"Example Eclipse make target"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(73145).Z,width:"417",height:"454"})),(0,o.kt)("h1",{id:"gdb-and-openocd"},"GDB and OpenOCD"),(0,o.kt)("p",null,"start openocd"),(0,o.kt)("p",null,"Create a new debug configuration in eclipse :\n",(0,o.kt)("img",{parentName:"p",src:"http://i.imgur.com/somJLnq.png",alt:"connect to openocd"}),"\n",(0,o.kt)("img",{parentName:"p",src:"http://i.imgur.com/LTtioaF.png",alt:"use workspace default"})),(0,o.kt)("p",null,"you can control openocd with a telnet connection:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"}," telnet localhost 4444\n")),(0,o.kt)("p",null,"stop the board, flash the firmware, restart:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"}," reset halt\n wait_halt\n sleep 100\n poll\n flash probe 0\n flash write_image erase /home/user/git/cleanflight/obj/cleanflight_NAZE.hex 0x08000000\n sleep 200\n soft_reset_halt\n wait_halt\n poll\n reset halt\n")),(0,o.kt)("p",null,"A this point you can launch the debug in Eclispe.\n",(0,o.kt)("img",{parentName:"p",src:"http://i.imgur.com/u7wDgxv.png",alt:null})),(0,o.kt)("h1",{id:"gdb-and-j-link"},"GDB and J Link"),(0,o.kt)("p",null,"Here are some screenshots showing Hydra's configuration of Eclipse (Kepler)"),(0,o.kt)("p",null,"If you use cygwin to build the binaries then be sure to have configured your common ",(0,o.kt)("inlineCode",{parentName:"p"},"Source Lookup Path"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"Path Mappings")," first, like this:"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(1143).Z,width:"777",height:"529"})),(0,o.kt)("p",null,"Create a new ",(0,o.kt)("inlineCode",{parentName:"p"},"GDB Hardware Debugging")," launch configuration from the ",(0,o.kt)("inlineCode",{parentName:"p"},"Run")," menu"),(0,o.kt)("p",null,"It's important to have build the executable compiled with GDB debugging information first.\nSelect the appropriate .elf file (not hex file) - In these examples the target platform is an OLIMEXINO."),(0,o.kt)("p",null,"DISABLE auto-build"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(30289).Z,width:"1008",height:"780"})),(0,o.kt)("p",null,"Choose the appropriate gdb executable - ideally from the same toolchain that you use to build the executable."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(49034).Z,width:"1008",height:"780"})),(0,o.kt)("p",null,"Configure Startup as follows"),(0,o.kt)("p",null,"Initialization commands"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"target remote localhost:2331\nmonitor interface SWD\nmonitor speed 2000\nmonitor flash device = STM32F103RB\nmonitor flash download = 1\nmonitor flash breakpoints = 1\nmonitor endian little\nmonitor reset\n")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(58664).Z,width:"1008",height:"780"})),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(8393).Z,width:"1008",height:"780"})),(0,o.kt)("p",null,"It may be useful to specify run commands too:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"monitor reg r13 = (0x00000000)\nmonitor reg pc = (0x00000004)\ncontinue\n")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(44592).Z,width:"968",height:"702"})),(0,o.kt)("p",null,"If you use cygwin an additional entry should be shown on the Source tab (not present in this screenshot)"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(57987).Z,width:"1008",height:"780"})),(0,o.kt)("p",null,"Nothing to change from the defaults on the Common tab"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(69808).Z,width:"1008",height:"780"})),(0,o.kt)("p",null,"Start up the J-Link server in USB mode"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(48060).Z,width:"460",height:"478"})),(0,o.kt)("p",null,"If it connects to your target device it should look like this"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(65668).Z,width:"550",height:"405"})),(0,o.kt)("p",null,"From Eclipse launch the application using the Run/Debug Configurations..., Eclipse should upload the compiled file to the target device which looks like this"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(26102).Z,width:"430",height:"155"})),(0,o.kt)("p",null,"When it's running the J-Link server should look like this."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(79114).Z,width:"550",height:"405"})),(0,o.kt)("p",null,"Then finally you can use Eclipse debug features to inspect variables, memory, stacktrace, set breakpoints, step over code, etc."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(25389).Z,width:"1928",height:"1200"})),(0,o.kt)("p",null,"If Eclipse can't find your breakpoints and they are ignored then check your path mappings (if using cygwin) or use the other debugging launcher as follows. Note the 'Select other...' at the bottom of the configuration window."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(29539).Z,width:"739",height:"702"})))}g.isMDXComponent=!0},30289:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/config 1-5a0b51725e589c348cb3bc50764399f8.PNG"},65668:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/config 10-0230df0652b22a76a5f0e92fc7b26380.PNG"},26102:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/config 11-dfb8b33cbf69a4fbe4e8bd48d60b5f02.PNG"},79114:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/config 12-47ca19fc09f709711125ad35f0276b7e.PNG"},44592:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/config 13-2c7f10eee2aafa4741690dc894fa9208.PNG"},49034:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/config 2-fcd29aa43255d70c0eb4301b665bd7f5.PNG"},58664:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/config 3-8cf7c230c20eed94f577f05ffa725c3b.PNG"},8393:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/config 4-f22243ebb64a417f14720611af5b099b.PNG"},57987:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/config 5-175b542bf0010fb655122e7270b67eb3.PNG"},69808:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/config 6-d0553237b396e1aef99acb0fca8354bc.PNG"},1143:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/config 7-c3886a808b131c778dc6a7cb3346aff1.PNG"},29539:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/config 8 - If breakpoints do not work-e29adbd3299db514b5ed73e7ea0147c9.PNG"},48060:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/config 9-a33165703d8f989abf4acefb1f7f5f54.PNG"},25389:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/debugging-28f81874a22ea23f55ab8cf42a0b4abe.PNG"},73145:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/make 1 - OLIMEXINO GDB-2f65e46006ea10b03b89f1cfc133328e.PNG"}}]);
"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2899],{3905:(e,t,r)=>{r.d(t,{Zo:()=>d,kt:()=>f});var n=r(67294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var s=n.createContext({}),p=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},d=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(r),u=i,f=c["".concat(s,".").concat(u)]||c[u]||m[u]||a;return r?n.createElement(f,o(o({ref:t},d),{},{components:r})):n.createElement(f,o({ref:t},d))}));function f(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=r.length,o=new Array(a);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:i,o[1]=l;for(var p=2;p<a;p++)o[p]=r[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}u.displayName="MDXCreateElement"},27266:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>a,metadata:()=>l,toc:()=>p});var n=r(87462),i=(r(67294),r(3905));const a={},o="The FrSky SPI RX",l={unversionedId:"development/FrSky-SPI-RX",id:"development/FrSky-SPI-RX",title:"The FrSky SPI RX",description:"Basics",source:"@site/docs/development/FrSky-SPI-RX.md",sourceDirName:"development",slug:"/development/FrSky-SPI-RX",permalink:"/betaflight.com/docs/development/FrSky-SPI-RX",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"development",previous:{title:"Failsafe",permalink:"/betaflight.com/docs/development/Failsafe"},next:{title:"Getting Started",permalink:"/betaflight.com/docs/development/Getting-Started"}},s={},p=[{value:"Basics",id:"basics",level:2},{value:"The FrSky SPI RX",id:"the-frsky-spi-rx-1",level:2},{value:"FrSky D",id:"frsky-d",level:3},{value:"FrSky X",id:"frsky-x",level:3},{value:"FrSky X LBT",id:"frsky-x-lbt",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Tips &amp; Tricks",id:"tips--tricks",level:2},{value:"Acknowledgements",id:"acknowledgements",level:2},{value:"Boards with FrSky SPI RX",id:"boards-with-frsky-spi-rx",level:2}],d={toc:p};function c(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"the-frsky-spi-rx"},"The FrSky SPI RX"),(0,i.kt)("h2",{id:"basics"},"Basics"),(0,i.kt)("p",null,"'SPI RX' in Betaflight is a framework that allows for radio chips to be connected directly to the flight controller's MCU, and to be controlled by the firmware. This allows for the implementation of the functionality that controls the radio chip, and translates the received signals into RC control signals as part of the firmware."),(0,i.kt)("p",null,"This has a number of advantages:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"the RX can be directly added to the flight controller board, allowing for smaller builds (after all, not many people want to use a flight controller ",(0,i.kt)("em",{parentName:"li"},"without")," an RX);"),(0,i.kt)("li",{parentName:"ul"},"it does not require one or more extra UARTs on the flight controller, and there is no risk of problems caused by a wrong UART configuration;"),(0,i.kt)("li",{parentName:"ul"},"it does not require an extra MCU to control the radio chip, and can therefore be produced / sold cheaper;"),(0,i.kt)("li",{parentName:"ul"},"since the RX 'firmware' is part of the flight controller firmware, fixes and updates will be applied as part of flight controller firmware updates, eliminating the need for (often cumbersome) RX firmware updates.")),(0,i.kt)("p",null,"But there are also disadvantages:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"a flight controller board will only have one radio chip, and will only be able to support the RC protocols that are using this chip. Changing to a different protocol is often not possible.")),(0,i.kt)("h2",{id:"the-frsky-spi-rx-1"},"The FrSky SPI RX"),(0,i.kt)("p",null,"This driver uses the SPI RX framework in Betaflight to provide support for the FrSky 2.4 GHz RC protocols, based on a CC2500 radio chip, with additional support for a PA/LNA (power amplifier / low noise amplifier) chip with antenna diversity, in order to provide sufficient power / sensitivity for outdoor flying."),(0,i.kt)("p",null,"The supported protocols are:"),(0,i.kt)("h3",{id:"frsky-d"},"FrSky D"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"8 channels / 9 ms frame spacing;"),(0,i.kt)("li",{parentName:"ul"},"called 'D8' in OpenTX;"),(0,i.kt)("li",{parentName:"ul"},"integrated FrSky hub telemetry.")),(0,i.kt)("h3",{id:"frsky-x"},"FrSky X"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"8 channels / 9 ms frame spacing ",(0,i.kt)("strong",{parentName:"li"},"or")," 16 channels / 18 ms frame spacing;"),(0,i.kt)("li",{parentName:"ul"},"called 'D16' in OpenTX;"),(0,i.kt)("li",{parentName:"ul"},"integrated FrSky SmartPort telemetry (including support for MSP over Smartport / lua scripts in OpenTX);")),(0,i.kt)("h3",{id:"frsky-x-lbt"},"FrSky X LBT"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"LBT protocol version compatible with EU;"),(0,i.kt)("li",{parentName:"ul"},"8 channels / 9 ms frame spacing ",(0,i.kt)("strong",{parentName:"li"},"or")," 16 channels / 18 ms frame spacing;"),(0,i.kt)("li",{parentName:"ul"},"called 'D16' in OpenTX;"),(0,i.kt)("li",{parentName:"ul"},"integrated FrSky SmartPort telemetry (including support for MSP over Smartport / lua scripts in OpenTX);")),(0,i.kt)("h2",{id:"configuration"},"Configuration"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"in Betaflight configurator, go to the 'Configuration' tab, in 'Receiver' box, select 'SPI RX support' for 'Receiver mode':")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"FrSky SPI RX mode selection",src:r(50598).Z,width:"646",height:"212"})),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"in the 'SPI Bus Receiver Provider' drop down that appears, select 'FRSKY_D', 'FRSKY_X' or 'FRSKY_X_LBT' (depending on the desired protocol):")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"FrSky SPI RX protocol selection",src:r(12761).Z,width:"645",height:"454"})),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},"click 'Save & Reboot'. After the reboot, the RX LED will confirm that the FrSky RX is active by blinking slowly;"),(0,i.kt)("li",{parentName:"ol"},"enter bind mode by either:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"pressing the 'Bind' button on the flight controller (if there is one and it's reachable);"),(0,i.kt)("li",{parentName:"ul"},"entering CLI, and typing 'bind_rx_spi","[Enter]","'.")),(0,i.kt)("ol",{start:5},(0,i.kt)("li",{parentName:"ol"},"the flight controller will indicate that bind mode is active by changing the RX LED to be permanently on. Now, on your TX, enter bind mode for the selected FrSky protocol (see screenshots for OpenTX):")),(0,i.kt)("p",null,"FrSky D protocol:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"FrSky SPI RX FrSky D binding with OpenTX",src:r(80810).Z,width:"2984",height:"970"})),(0,i.kt)("p",null,"FrSky X and X_LBT protocol:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"FrSky SPI RX FrSky X binding with OpenTX",src:r(5363).Z,width:"3046",height:"984"})),(0,i.kt)("ol",{start:6},(0,i.kt)("li",{parentName:"ol"},"Once binding has completed, the flight controller will indicate this by blinking the RX LED slowly. There's no indication on the CLI, but you can observe successful binding by quitting the bind mode on TX, and seeing if ",(0,i.kt)("inlineCode",{parentName:"li"},"status"),' doesn\'t list RXLOSS anymore in "Arming disable flags". A reboot of the flight controller is not required.')),(0,i.kt)("h2",{id:"tips--tricks"},"Tips & Tricks"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"the RX bind information is stored in the following CLI parameters: ",(0,i.kt)("inlineCode",{parentName:"li"},"frsky_spi_tx_id")," (internal TX id), ",(0,i.kt)("inlineCode",{parentName:"li"},"frsky_spi_offset")," (frequency offset), ",(0,i.kt)("inlineCode",{parentName:"li"},"frsky_spi_bind_hop_data")," (frequency hop sequence), and ",(0,i.kt)("inlineCode",{parentName:"li"},"frsky_x_rx_num")," (RX number; FrSky X only). These are printed as part of a CLI ",(0,i.kt)("inlineCode",{parentName:"li"},"diff")," / ",(0,i.kt)("inlineCode",{parentName:"li"},"dump"),", and will be restored after a firmware update, making it unnecessary to do another bind after the update;"),(0,i.kt)("li",{parentName:"ul"},"resetting the above parameters to defaults will 'erase' the binding information;"),(0,i.kt)("li",{parentName:"ul"},"the CLI parameter ",(0,i.kt)("inlineCode",{parentName:"li"},"frsky_spi_autobind")," can be enabled to configure the FrSky SPI RX to attempt a bind on every power up. This is mostly useful for demonstration models that should bind to whatever TX is powered up in the vicinity.")),(0,i.kt)("h2",{id:"acknowledgements"},"Acknowledgements"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"midelic for reverse engineering and reimplementation of the FrSky protocols;"),(0,i.kt)("li",{parentName:"ul"},"Eric Freund (",(0,i.kt)("a",{parentName:"li",href:"mailto:eric_fre@hotmail.com"},"eric_fre@hotmail.com"),") for the design of the first prototype flight controller with FrSky SPI RX.")),(0,i.kt)("h2",{id:"boards-with-frsky-spi-rx"},"Boards with FrSky SPI RX"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"http://www.mateksys.com/?portfolio=f411-one"},"Matek F411-ONE"),";"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"boards/CRAZYBEEF3FR.md"},"CrazyBee F3 FR"),";"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"boards/CRAZYBEEF4FRPRO.md"},"CrazyBee F4 FR Pro"),";"),(0,i.kt)("li",{parentName:"ul"},"[BetaFPV F4]"),(0,i.kt)("li",{parentName:"ul"},"more to come...")))}c.isMDXComponent=!0},80810:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/frsky_spi_rx_d_binding-6447567c70a258020b4851183a412cd9.png"},50598:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/frsky_spi_rx_mode-f7816486ea9d6ba99d77a8a69350bac1.png"},12761:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/frsky_spi_rx_protocol-36a15c82705e501d7a4fd08bbe668536.png"},5363:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/frsky_spi_rx_x_binding-c3ce64adc2a1563594f85dd7651ad8ed.png"}}]);